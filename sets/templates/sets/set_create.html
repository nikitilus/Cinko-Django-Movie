{% extends "main/layout.html" %}

{% block title %}Создание категории{% endblock title %}

{% block content %}
<h1 class='welcome'>Создайте категорию</h1>
<div class="register">
<form method="post">
    {% csrf_token %}
    {{ form.name }}
    {{ form.description }}
    {{ form.image }}
    {{ form.slug }}

    <button type="submit" class="btn btn-primary">Создать</button>

</form>
<h1>{{ error }}<h1>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById("id_name");
    const slugInput = document.getElementById("id_slug");

    function transliterate(text) {
        const ru = [
            'а','б','в','г','д','е','ё','ж','з','и','й','к','л','м','н','о','п','р','с','т','у','ф','х','ц','ч','ш','щ','ъ','ы','ь','э','ю','я'
        ];
        const en = [
            'a','b','v','g','d','e','e','zh','z','i','y','k','l','m','n','o','p','r','s','t','u','f','h','ts','ch','sh','sch','','y','','e','yu','ya'
        ];
        return text.split('').map(function(char) {
            const lower = char.toLowerCase();
            const index = ru.indexOf(lower);
            if (index >= 0) {
                return char === lower ? en[index] : en[index].toUpperCase();
            }
            return char;
        }).join('');
    }

    function slugify(text) {
        return transliterate(text)
            .toLowerCase()
            .replace(/[\s_]+/g, '-')           // пробелы и _ на дефис
            .replace(/[^\w\-]+/g, '')          // убрать не буквы/цифры/дефисы
            .replace(/\-\-+/g, '-')            // несколько дефисов в один
            .replace(/^-+/, '')                // убрать дефисы в начале
            .replace(/-+$/, '');               // убрать дефисы в конце
    }

    if (nameInput && slugInput) {
        nameInput.addEventListener('input', function() {
            slugInput.value = slugify(nameInput.value);
        });
    }
});
</script>

{% endblock content %}
